{
  "entities": {
    "Patient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Patient",
      "type": "object",
      "description": "Represents a patient with their medical history, care plans, and emergency contacts.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Patient entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the patient."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the patient."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "The date of birth of the patient.",
          "format": "date-time"
        },
        "medicalHistory": {
          "type": "string",
          "description": "A summary of the patient's medical history."
        },
        "carePlan": {
          "type": "string",
          "description": "Details of the patient's care plan."
        },
        "emergencyContactName": {
          "type": "string",
          "description": "Name of the emergency contact."
        },
        "emergencyContactPhone": {
          "type": "string",
          "description": "Phone number of the emergency contact."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "dateOfBirth"
      ]
    },
    "DailyRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DailyRecord",
      "type": "object",
      "description": "Represents a daily record of activities, medication administration, and observations for a patient.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DailyRecord entity."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N DailyRecord)"
        },
        "date": {
          "type": "string",
          "description": "The date of the record.",
          "format": "date-time"
        },
        "activities": {
          "type": "string",
          "description": "Description of daily activities."
        },
        "medicationAdministration": {
          "type": "string",
          "description": "Details of medication administered."
        },
        "observations": {
          "type": "string",
          "description": "Relevant observations for the patient."
        }
      },
      "required": [
        "id",
        "patientId",
        "date"
      ]
    },
    "Staff": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Staff",
      "type": "object",
      "description": "Represents a staff member with their profile, schedule, and role information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Staff entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the staff member."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the staff member."
        },
        "role": {
          "type": "string",
          "description": "The role of the staff member (e.g., nurse, doctor)."
        },
        "schedule": {
          "type": "string",
          "description": "The schedule of the staff member."
        },
        "certifications": {
          "type": "string",
          "description": "List of certifications held by the staff member."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "role"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents a generated report based on recorded data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Report entity."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N Report)"
        },
        "reportType": {
          "type": "string",
          "description": "The type of report (e.g., progress report, incident report)."
        },
        "dateGenerated": {
          "type": "string",
          "description": "The date the report was generated.",
          "format": "date-time"
        },
        "content": {
          "type": "string",
          "description": "The content of the report."
        }
      },
      "required": [
        "id",
        "patientId",
        "reportType",
        "dateGenerated"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/patients/{patientId}",
        "definition": {
          "entityName": "Patient",
          "schema": {
            "$ref": "#/backend/entities/Patient"
          },
          "description": "Stores patient profiles owned by a specific user.  Uses path-based ownership for security.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the patient profile."
            },
            {
              "name": "patientId",
              "description": "The ID of the patient."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/patients/{patientId}/dailyRecords/{dailyRecordId}",
        "definition": {
          "entityName": "DailyRecord",
          "schema": {
            "$ref": "#/backend/entities/DailyRecord"
          },
          "description": "Stores daily records for a specific patient. Uses path-based ownership. The patientId is denormalized within the DailyRecord document for independent authorization.  Enables secure listing of daily records for a specific patient.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the patient profile."
            },
            {
              "name": "patientId",
              "description": "The ID of the patient associated with the daily record."
            },
            {
              "name": "dailyRecordId",
              "description": "The ID of the daily record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/patients/{patientId}/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "Stores reports for a specific patient. Uses path-based ownership. The patientId is denormalized within the Report document for independent authorization. Enables secure listing of reports for a specific patient.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the patient profile."
            },
            {
              "name": "patientId",
              "description": "The ID of the patient associated with the report."
            },
            {
              "name": "reportId",
              "description": "The ID of the report."
            }
          ]
        }
      },
      {
        "path": "/staff/{staffId}",
        "definition": {
          "entityName": "Staff",
          "schema": {
            "$ref": "#/backend/entities/Staff"
          },
          "description": "Stores staff profiles.  Separate from user profiles.  Admin role can be controlled via /roles_admin/{uid}.",
          "params": [
            {
              "name": "staffId",
              "description": "The ID of the staff member."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "role",
          "schema": {
            "$ref": "#/backend/entities/Staff"
          },
          "description": "Indicates admin role by document existence.  No data is stored in the document itself.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who has admin role."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure secure and scalable data management for the CareHub Pro application. It follows the principles of Authorization Independence, Structural Segregation, and Access Modeling.  Specifically, authorization independence is achieved by avoiding `get()` calls in security rules through path-based ownership for private user data.  This approach supports atomic operations (transactions/batches). Segregation is used to enforce uniform security requirements within collections. The structure facilitates secure list operations (QAPs) using path-based ownership and avoids custom claims (DBAC), relying solely on `request.auth.uid` and data stored within the documents. The path-based ownership `/users/{userId}/patients/{patientId}` is a core element. For collaborative data, the 'members' map strategy is recommended in the future, but is not currently implemented. The structure strictly models data and avoids dynamic keys.  Timestamps and denormalized ownership data maintain data integrity."
  }
}